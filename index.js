var canvas = document.querySelector("canvas");
var ctx = canvas.getContext('2d');

// var canvas = document.querySelector("canvas");
var tilesetContainer = document.querySelector(".tileset-container");
var tilesetSelection = document.querySelector(".tileset-container_selection");
var tilesetImage = document.querySelector("#tileset-source");

canvas.width = window.innerWidth;

var selection = [0, 0]; //Which tile we will paint from the menu

var tileSize = 32;
// var zoom = 1;


let scale       = 1;
let scaleFactor = 0.2;
let scrollX     = 0;
let scrollY     = 0;

var originx = 0;
var originy = 0;

var isMouseDown = false;
var currentLayer = 0;
var layers = [
    //Bottom
    {
        //Structure is "x-y": ["tileset_x", "tileset_y"]
        //EXAMPLE: "1-1": [3, 4],
    },
    //Middle
    {},
    //Top
    {}
];


//Select tile from the Tiles grid
tilesetContainer.addEventListener("mousedown", (event) => {
    selection = getCoordsUX(event);
    console.log(selection)
    tilesetSelection.style.left = selection[0] * tileSize + "px";
    tilesetSelection.style.top = selection[1] * tileSize + "px";
    // console.log('tilesetSelection.style.left', tilesetSelection.style.left)
});

//Handler for placing new tiles on the map
function addTile(mouseEvent) {
    var clicked = getCoords(event);
    var key = clicked[0] + "-" + clicked[1];

    console.log('key', key)

    if (mouseEvent.shiftKey) {
        delete layers[currentLayer][key];
    } else {
        layers[currentLayer][key] = [selection[0], selection[1]];
    }
    draw();
}

//Bind mouse events for painting (or removing) tiles on click/drag
canvas.addEventListener("mousedown", () => {
    isMouseDown = true;
});
canvas.addEventListener("mouseup", () => {
    isMouseDown = false;
    // console.log(JSON.stringify(layers))
});
canvas.addEventListener("mouseleave", () => {
    isMouseDown = false;
});
canvas.addEventListener("mousedown", addTile);
canvas.addEventListener("mousemove", (event) => {
    if (isMouseDown) {
        addTile(event);
    }
});

// // Handle mousenwheel zoom
ctx.canvas.onwheel =  function(e){
    e.preventDefault();
    let previousScale= scale;
    
    // calculate scale direction 6 new scale value
    let direction = e.deltaY > 0 ? 1 : -1;
    scale += scaleFactor * direction;
    
    if (scale <= 0.2) {
        scale = 0.2;
    }
    // calculate the new scroll values
    scrollX += ( e.offsetX / previousScale )  - (e.offsetX  / scale);
    scrollY += ( e.offsetY / previousScale ) - ( e.offsetY / scale);
    
    // apply new scale in a non acumulative way
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.scale(scale, scale);

    draw();



    // var mousex = e.clientX - canvas.offsetLeft;
    // var mousey = e.clientY - canvas.offsetTop;
    // var wheel = e.wheelDelta/120;//n or -n


    // //according to Chris comment
    // var zoom = Math.pow(1 + Math.abs(wheel)/2 , wheel > 0 ? 1 : -1);

    // ctx.translate(
    //     originx,
    //     originy
    // );
    // ctx.scale(zoom,zoom);
    // ctx.translate(
    //     -( mousex / scale + originx - mousex / ( scale * zoom ) ),
    //     -( mousey / scale + originy - mousey / ( scale * zoom ) )
    // );

    // originx = ( mousex / scale + originx - mousex / ( scale * zoom ) );
    // originy = ( mousey / scale + originy - mousey / ( scale * zoom ) );
    // scale *= zoom;

    // draw();
}
  

//Utility for getting coordinates of mouse click
function getCoords(e) {
    const { x, y } = e.target.getBoundingClientRect();
    // console.log(x, y)
    const mouseX = e.clientX - x;
    const mouseY = e.clientY - y;

    console.log(mouseX, mouseY)

    return [Math.floor(mouseX / tileSize / scale), Math.floor(mouseY / tileSize / scale)];
    // return [Math.floor(mouseX / tileSize), Math.floor(mouseY / tileSize )];
    // return [Math.floor(mouseX / tileSize * scale), Math.floor(mouseY / tileSize * scale)];
}

//Utility for getting coordinates of mouse click
function getCoordsUX(e) {
    const { x, y } = e.target.getBoundingClientRect();
    const mouseX = e.clientX - x;
    const mouseY = e.clientY - y;

    return [Math.floor(mouseX / tileSize), Math.floor(mouseY / tileSize)];
}


//converts data to image:data string and pipes into new browser tab
const exportImage = () => {
    var data = canvas.toDataURL();
    var image = new Image();
    image.src = data;

    var w = window.open("");
    w.document.write(image.outerHTML);
}

//Reset state to empty
function clearCanvas() {
    layers = [{}, {}, {}];
    draw();
}

function zoomIt() {
    ctx.scale(2, 2);
    draw();
}

function setLayer(newLayer) {
    //Update the layer
    currentLayer = newLayer;

    //Update the UI to show updated layer
    var oldActiveLayer = document.querySelector(".layer.active");
    if (oldActiveLayer) {
        oldActiveLayer.classList.remove("active");
    }
    document.querySelector(`[tile-layer="${currentLayer}"]`).classList.add("active");
}

function draw() {
    var ctx = canvas.getContext("2d");
    // ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.clearRect(originx,originy,ctx.canvas.width/scale, ctx.canvas.height/scale);
    console.log(originx,originy,ctx.canvas.width/scale, ctx.canvas.height/scale)
    var size_of_crop = tileSize;

    layers.forEach((layer) => {
        Object.keys(layer).forEach((key) => {
            //Determine x/y position of this placement from key ("3-4" -> x=3, y=4)
            var positionX = Number(key.split("-")[0]);
            var positionY = Number(key.split("-")[1]);
            var [tilesheetX, tilesheetY] = layer[key];

            ctx.drawImage(
                tilesetImage,
                tilesheetX * tileSize,
                tilesheetY * tileSize,
                size_of_crop,
                size_of_crop,
                positionX * tileSize,
                positionY * tileSize,
                size_of_crop,
                size_of_crop
            );
        });
    });
}

//Default image for booting up -> Just looks nicer than loading empty canvas
// var defaultState = [{ "0-4": [3, 2], "1-4": [4, 2], "2-4": [4, 2], "3-4": [4, 2], "4-4": [4, 1], "5-5": [4, 2], "6-5": [4, 2], "7-5": [4, 2], "8-5": [4, 2], "9-5": [4, 2], "10-5": [4, 2], "11-6": [3, 2], "12-6": [4, 2], "13-6": [4, 2], "14-6": [4, 2], "12-5": [4, 1], "5-4": [4, 1], "3-3": [4, 1], "0-3": [4, 1], "1-3": [4, 1], "4-3": [4, 1], "5-3": [4, 1], "7-3": [4, 1], "8-3": [4, 1], "9-3": [4, 1], "10-3": [4, 1], "10-4": [4, 1], "11-4": [4, 1], "11-5": [4, 1], "4-5": [3, 2], "2-3": [4, 1], "6-3": [4, 1], "11-3": [4, 1], "12-3": [4, 1], "13-3": [4, 1], "14-3": [4, 1], "6-4": [4, 1], "7-4": [4, 1], "8-4": [4, 1], "9-4": [4, 1], "12-4": [4, 1], "13-4": [4, 1], "14-4": [4, 1], "13-5": [4, 1], "14-5": [4, 1], "14-2": [4, 1], "13-2": [4, 1], "12-2": [4, 1], "11-2": [4, 1], "10-2": [4, 1], "9-2": [4, 1], "8-2": [4, 1], "7-2": [4, 1], "6-2": [4, 1], "5-2": [4, 1], "4-2": [4, 1], "3-2": [4, 1], "2-2": [4, 1], "1-2": [4, 1], "0-2": [4, 1], "0-1": [4, 1], "1-1": [4, 1], "2-1": [4, 1], "3-1": [4, 1], "4-1": [4, 1], "6-1": [4, 1], "8-1": [4, 1], "9-1": [4, 1], "10-1": [4, 1], "11-1": [4, 1], "12-1": [4, 1], "13-1": [4, 1], "14-1": [4, 1], "7-1": [4, 1], "5-1": [4, 1], "0-0": [4, 1], "1-0": [4, 1], "2-0": [4, 1], "3-0": [4, 1], "4-0": [4, 1], "5-0": [4, 1], "6-0": [4, 1], "7-0": [4, 1], "8-0": [4, 1], "9-0": [4, 1], "10-0": [4, 1], "11-0": [4, 1], "12-0": [4, 1], "13-0": [4, 1], "14-0": [4, 1], "14-14": [2, 6], "7-14": [3, 6], "6-14": [2, 6], "5-14": [3, 6], "4-13": [3, 6], "3-13": [2, 6], "1-11": [2, 10], "1-10": [2, 10], "0-8": [0, 6], "0-10": [2, 10], "3-10": [3, 6], "4-10": [2, 6], "0-5": [3, 6], "0-6": [0, 6], "0-7": [1, 6], "0-9": [1, 6], "0-11": [2, 10], "0-12": [2, 10], "0-13": [2, 10], "0-14": [0, 6], "1-14": [1, 6], "1-13": [2, 10], "1-12": [3, 6], "1-9": [2, 6], "1-8": [1, 6], "1-7": [0, 6], "1-6": [3, 6], "1-5": [2, 6], "2-5": [3, 6], "2-6": [2, 6], "2-7": [3, 6], "2-8": [0, 6], "2-9": [3, 6], "2-13": [2, 10], "2-14": [0, 6], "3-14": [1, 6], "3-12": [3, 6], "3-11": [2, 6], "3-9": [2, 6], "3-8": [3, 6], "3-7": [2, 6], "3-6": [3, 6], "3-5": [2, 6], "4-6": [2, 6], "4-7": [3, 6], "4-8": [2, 6], "4-9": [3, 6], "4-11": [3, 6], "4-12": [2, 6], "4-14": [2, 6], "5-13": [2, 6], "5-12": [4, 10], "5-11": [4, 10], "5-10": [4, 10], "5-9": [4, 10], "5-8": [3, 6], "5-7": [2, 6], "5-6": [3, 6], "6-6": [2, 6], "6-7": [3, 6], "6-8": [2, 6], "6-9": [4, 10], "6-10": [4, 10], "6-11": [4, 10], "6-12": [4, 10], "6-13": [3, 6], "7-13": [2, 6], "7-12": [4, 10], "7-10": [4, 10], "7-9": [4, 10], "7-8": [3, 6], "7-7": [2, 6], "7-6": [3, 6], "8-6": [2, 6], "8-7": [3, 6], "8-10": [4, 10], "8-11": [4, 10], "8-12": [4, 10], "8-14": [2, 6], "8-13": [3, 6], "9-14": [3, 6], "9-13": [2, 6], "9-12": [4, 10], "9-11": [4, 10], "9-10": [4, 10], "9-7": [2, 6], "9-6": [3, 6], "10-7": [3, 6], "10-8": [2, 6], "10-9": [3, 6], "10-10": [2, 6], "10-11": [3, 6], "10-12": [2, 6], "10-13": [3, 6], "10-14": [2, 6], "10-6": [2, 6], "11-7": [2, 6], "12-7": [3, 6], "13-7": [2, 6], "14-7": [2, 6], "14-8": [2, 6], "14-9": [3, 6], "14-10": [4, 3], "14-11": [4, 4], "14-12": [2, 6], "14-13": [3, 6], "13-14": [3, 6], "12-14": [2, 6], "11-14": [3, 6], "11-13": [2, 6], "12-13": [3, 6], "13-13": [2, 6], "13-12": [3, 6], "12-12": [2, 6], "11-12": [3, 6], "11-11": [2, 6], "12-11": [3, 6], "13-11": [4, 4], "13-10": [2, 6], "12-10": [2, 6], "11-10": [3, 6], "12-9": [3, 6], "13-9": [2, 6], "13-8": [3, 6], "12-8": [2, 6], "11-9": [2, 6], "11-8": [3, 6], "2-10": [2, 10], "2-11": [2, 10], "2-12": [2, 10], "8-9": [4, 10], "8-8": [4, 10], "9-9": [4, 10], "9-8": [4, 10], "7-11": [4, 10] }, { "5-9": [2, 7], "6-9": [2, 7], "7-9": [2, 7], "3-9": [0, 6], "3-11": [0, 6], "3-13": [0, 6], "1-9": [0, 6], "2-9": [1, 6], "1-10": [1, 7], "3-10": [1, 6], "3-12": [1, 6], "2-10": [1, 7], "1-12": [2, 10], "0-8": [1, 2], "1-8": [1, 2], "2-8": [1, 2], "2-7": [2, 1], "2-6": [2, 0], "1-6": [1, 0], "0-6": [1, 0], "1-7": [1, 1], "0-7": [1, 1], "11-11": [3, 3], "12-11": [4, 3], "13-11": [4, 4], "14-11": [4, 4], "11-12": [3, 4], "11-13": [3, 5], "12-13": [4, 5], "13-13": [4, 5], "14-13": [4, 5], "12-12": [4, 4], "13-12": [4, 4], "14-12": [4, 4], "0-10": [0, 7], "13-10": [3, 3], "11-5": [3, 1], "4-4": [3, 1], "8-8": [2, 7], "9-8": [2, 7] }, { "0-5": [4, 12], "1-5": [4, 12], "2-5": [4, 12], "3-5": [4, 12], "4-6": [4, 12], "5-6": [4, 12], "6-6": [4, 12], "7-6": [4, 12], "8-6": [4, 12], "9-6": [4, 12], "10-6": [4, 12], "11-7": [4, 12], "12-7": [4, 12], "13-7": [4, 12], "14-7": [4, 12], "0-9": [4, 12], "1-9": [4, 12], "2-9": [4, 12], "11-14": [4, 12], "12-14": [4, 12], "13-14": [4, 12], "14-14": [4, 12], "6-2": [2, 15], "6-3": [0, 13], "7-3": [3, 12], "8-3": [0, 14], "9-3": [1, 16], "10-3": [1, 15], "11-3": [4, 15], "4-2": [4, 14], "5-2": [0, 12], "4-1": [0, 13], "3-1": [3, 14], "1-1": [1, 16], "2-1": [0, 14], "11-1": [4, 2], "12-1": [4, 2], "13-1": [5, 2], "11-0": [4, 0], "12-0": [4, 0], "13-0": [5, 0], "10-1": [4, 2], "9-1": [3, 2], "10-0": [4, 0], "9-0": [3, 0], "9-2": [4, 12], "10-2": [4, 12], "11-2": [4, 12], "12-2": [4, 12], "13-2": [4, 12], "5-13": [4, 13], "9-13": [5, 13], "6-13": [4, 11], "7-13": [4, 11], "8-13": [4, 11], "0-14": [4, 11], "1-14": [4, 11], "2-14": [5, 13] }]
// var defaultState = [{}]
var defaultState = [{"96-45":[0,0],"96-44":[0,0],"96-43":[0,0],"96-42":[0,0],"96-41":[0,0],"96-40":[0,0],"97-40":[0,0],"97-39":[0,0],"98-38":[0,0],"99-37":[0,0],"100-36":[0,0],"101-36":[0,0],"102-35":[0,0],"103-35":[0,0],"104-35":[0,0],"105-35":[0,0],"105-36":[0,0],"106-36":[0,0],"107-37":[0,0],"107-38":[0,0],"108-39":[0,0],"108-40":[0,0],"108-41":[0,0],"108-42":[0,0],"108-43":[0,0],"107-44":[0,0],"107-45":[0,0],"106-45":[0,0],"106-44":[0,0],"107-43":[0,0],"107-42":[0,0],"109-40":[0,0],"109-39":[0,0],"110-39":[0,0],"110-38":[0,0],"111-38":[0,0],"112-38":[0,0],"112-37":[0,0],"113-37":[0,0],"114-37":[0,0],"115-37":[0,0],"115-38":[0,0],"116-38":[0,0],"116-39":[0,0],"117-40":[0,0],"117-41":[0,0],"118-41":[0,0],"118-42":[0,0],"118-43":[0,0],"118-44":[0,0],"118-45":[0,0],"118-46":[0,0],"118-47":[0,0],"118-48":[0,0],"118-49":[0,0],"117-49":[0,0],"117-50":[0,0],"106-35":[0,0],"106-34":[0,0],"106-33":[0,0],"106-32":[0,0],"106-31":[0,0],"106-30":[0,0],"107-30":[0,0],"107-29":[0,0],"107-28":[0,0],"108-28":[0,0],"108-27":[0,0],"108-26":[0,0],"109-25":[0,0],"109-24":[0,0],"110-23":[0,0],"110-22":[0,0],"111-22":[0,0],"111-21":[0,0],"112-21":[0,0],"112-20":[0,0],"113-20":[0,0],"113-19":[0,0],"114-18":[0,0],"115-17":[0,0],"116-17":[0,0],"116-16":[0,0],"117-16":[0,0],"118-16":[0,0],"118-15":[0,0],"119-15":[0,0],"120-15":[0,0],"121-15":[0,0],"122-15":[0,0],"122-16":[0,0],"123-17":[0,0],"123-18":[0,0],"123-19":[0,0],"123-20":[0,0],"123-21":[0,0],"123-22":[0,0],"123-23":[0,0],"123-24":[0,0],"123-25":[0,0],"122-25":[0,0],"122-26":[0,0],"122-27":[0,0],"121-28":[0,0],"121-29":[0,0],"120-29":[0,0],"120-30":[0,0],"120-31":[0,0],"119-31":[0,0],"119-32":[0,0],"119-33":[0,0],"118-33":[0,0],"118-34":[0,0],"118-35":[0,0],"117-35":[0,0],"117-36":[0,0],"116-36":[0,0],"116-37":[0,0],"122-17":[0,0],"121-17":[0,0],"121-18":[0,0],"121-19":[0,0],"120-19":[0,0],"120-20":[0,0],"120-21":[0,0],"119-22":[0,0],"119-23":[0,0],"118-23":[0,0],"118-24":[0,0],"119-21":[0,0],"119-20":[0,0],"120-18":[0,0],"121-16":[0,0],"44-22":[4,16],"45-22":[4,16],"46-22":[4,16],"48-22":[4,16],"51-22":[4,16],"52-22":[4,16],"54-23":[0,0],"56-23":[4,16],"58-23":[4,16],"60-24":[4,16],"62-25":[4,16],"63-26":[4,16],"64-26":[4,16],"65-28":[0,0],"66-29":[0,0],"66-30":[0,0],"67-32":[0,0],"67-33":[0,0],"67-34":[0,0],"66-35":[0,0],"66-36":[0,0],"65-37":[0,0],"64-38":[0,0],"63-39":[0,0],"62-39":[0,0],"61-39":[0,0],"60-40":[0,0],"58-40":[0,0],"57-40":[0,0],"56-40":[4,16],"55-40":[4,16],"54-39":[4,16],"54-38":[0,0],"54-36":[0,0],"54-34":[0,0],"54-31":[4,16],"54-30":[0,0],"55-28":[0,0],"57-26":[4,16],"58-24":[4,16],"59-23":[4,16],"60-23":[4,16],"61-22":[4,16],"62-22":[4,16],"63-22":[4,16],"64-22":[4,16],"64-23":[4,16],"65-24":[4,16],"65-25":[4,16],"65-26":[4,16],"65-27":[0,0],"64-28":[0,0],"64-29":[0,0],"63-29":[0,0],"62-29":[0,0],"61-29":[0,0],"61-28":[0,0],"60-28":[0,0],"59-28":[4,16],"4-4":[0,0],"4-3":[0,0],"5-3":[0,0],"6-3":[0,0],"7-3":[0,0],"7-4":[0,0],"7-5":[0,0],"6-6":[0,0],"6-7":[0,0],"5-7":[0,0],"4-8":[0,0],"5-8":[0,0],"6-8":[0,0],"7-8":[0,0],"8-8":[0,0],"9-8":[0,0],"10-8":[0,0],"9-9":[0,0],"8-9":[0,0],"7-9":[0,0],"6-9":[0,0],"1-2":[0,0],"2-2":[0,0],"2-1":[0,0],"3-1":[0,0],"4-1":[0,0],"5-1":[0,0],"6-1":[0,0],"6-0":[0,0],"7-0":[0,0],"8-0":[0,0],"8-1":[0,0],"9-1":[0,0],"9-2":[0,0],"15-2":[4,16],"15-3":[4,16],"15-4":[4,16],"15-5":[4,16],"15-6":[4,16],"15-7":[4,16],"15-8":[4,16],"15-9":[4,16],"15-10":[4,16],"15-11":[4,16],"15-12":[4,16],"15-13":[4,16],"16-9":[4,16],"16-8":[4,16],"16-7":[4,16],"17-7":[4,16],"17-6":[4,16],"17-8":[4,16],"17-9":[4,16],"16-10":[4,16],"16-11":[4,16],"16-12":[4,16],"16-13":[4,16],"16-14":[4,16],"17-13":[4,16],"17-12":[4,16],"18-12":[4,16],"18-11":[4,16],"19-11":[4,16],"20-10":[4,16],"21-10":[4,16],"21-9":[4,16],"21-11":[4,16],"20-11":[4,16],"20-12":[4,16],"19-13":[4,16],"19-14":[4,16],"20-13":[4,16],"21-12":[4,16],"22-11":[4,16],"23-10":[4,16],"24-9":[4,16],"25-9":[4,16],"25-8":[4,16],"26-8":[4,16],"24-11":[4,16],"23-12":[4,16],"22-14":[4,16],"22-15":[4,16],"21-15":[4,16],"21-16":[4,16],"22-16":[4,16],"23-15":[4,16],"24-14":[4,16],"25-13":[4,16],"26-13":[4,16],"26-12":[4,16],"27-12":[4,16],"28-12":[4,16],"28-11":[4,16],"27-13":[4,16],"26-15":[4,16],"25-16":[4,16],"24-17":[4,16],"23-19":[4,16],"22-20":[4,16],"22-21":[4,16],"21-22":[4,16],"23-21":[4,16],"24-20":[4,16],"25-19":[4,16],"27-18":[4,16],"27-17":[4,16],"29-17":[4,16],"29-16":[4,16],"30-16":[4,16],"30-15":[4,16],"31-15":[4,16],"30-17":[4,16],"29-18":[4,16],"28-20":[4,16],"27-21":[4,16],"26-23":[4,16],"25-24":[4,16],"24-25":[4,16],"23-26":[4,16],"23-27":[4,16],"22-28":[4,16],"24-26":[4,16],"25-25":[4,16],"26-24":[4,16],"27-23":[4,16],"28-22":[4,16],"29-21":[4,16],"30-20":[4,16],"30-19":[4,16],"31-19":[4,16],"31-18":[4,16],"30-21":[4,16],"29-22":[4,16],"28-23":[4,16],"27-25":[4,16],"27-26":[4,16],"26-27":[4,16],"26-28":[4,16],"25-28":[4,16],"28-25":[4,16],"29-24":[4,16],"30-23":[4,16],"31-22":[4,16],"32-22":[4,16],"32-21":[4,16],"33-20":[4,16],"33-21":[4,16],"32-23":[4,16],"31-23":[4,16],"31-24":[4,16],"30-25":[4,16],"29-26":[4,16],"29-25":[4,16],"29-23":[4,16],"29-20":[4,16],"27-20":[4,16],"26-20":[4,16],"25-20":[4,16],"23-20":[4,16],"21-21":[4,16],"20-22":[4,16],"19-22":[4,16],"18-23":[4,16],"17-23":[4,16],"16-23":[4,16],"16-24":[4,16],"15-24":[4,16],"18-24":[4,16],"19-25":[4,16],"20-25":[4,16],"21-25":[4,16],"22-26":[4,16],"24-27":[4,16],"25-27":[4,16],"24-28":[4,16],"23-28":[4,16],"21-28":[4,16],"19-29":[4,16],"18-29":[4,16],"17-29":[4,16],"16-30":[4,16],"15-30":[4,16],"14-30":[4,16],"14-31":[4,16],"15-32":[4,16],"16-33":[4,16],"17-34":[4,16],"17-35":[4,16],"18-36":[4,16],"18-37":[4,16],"18-38":[4,16],"19-39":[4,16],"19-40":[4,16],"19-41":[4,16],"19-42":[4,16],"19-43":[4,16],"18-44":[4,16],"19-45":[4,16],"20-46":[4,16],"21-46":[4,16],"22-47":[4,16],"23-47":[4,16],"24-47":[4,16],"26-47":[4,16],"27-47":[4,16],"28-47":[4,16],"29-48":[4,16],"30-48":[4,16],"31-48":[4,16],"31-47":[4,16],"32-47":[4,16],"32-46":[4,16],"32-45":[4,16],"32-44":[4,16],"32-43":[4,16],"32-42":[4,16],"32-41":[4,16],"31-40":[4,16],"31-39":[4,16],"31-38":[4,16],"32-38":[4,16],"33-38":[4,16],"33-39":[4,16],"34-39":[4,16],"34-40":[4,16],"35-41":[4,16],"36-41":[4,16],"37-42":[4,16],"37-43":[4,16],"38-44":[4,16],"39-44":[4,16],"38-43":[4,16],"38-42":[4,16],"37-41":[4,16],"36-40":[4,16],"36-39":[4,16],"35-39":[4,16],"35-38":[4,16],"36-38":[4,16],"37-38":[4,16],"38-38":[4,16],"38-37":[4,16],"38-36":[4,16],"38-35":[4,16],"37-33":[4,16],"37-32":[4,16],"37-31":[4,16],"36-31":[4,16],"36-30":[4,16],"37-30":[4,16],"38-31":[4,16],"38-32":[4,16],"39-32":[4,16],"39-33":[4,16],"40-33":[4,16],"40-32":[4,16],"40-31":[4,16],"39-30":[4,16],"39-29":[4,16],"38-28":[4,16],"38-27":[4,16],"38-26":[4,16],"37-26":[4,16],"37-25":[4,16],"37-24":[4,16],"37-23":[4,16],"37-22":[4,16],"38-20":[4,16],"38-18":[4,16],"38-17":[4,16],"38-16":[4,16],"39-17":[4,16],"39-18":[4,16],"39-19":[4,16],"39-20":[4,16],"39-21":[4,16],"40-21":[4,16],"40-22":[4,16],"39-16":[4,16],"40-16":[4,16],"41-16":[4,16],"42-16":[4,16],"43-16":[4,16],"43-15":[4,16],"42-15":[4,16],"41-15":[4,16],"40-15":[4,16],"39-15":[4,16],"37-16":[4,16],"36-16":[4,16],"36-17":[4,16],"37-17":[4,16],"43-14":[4,16],"44-14":[4,16],"42-14":[4,16],"41-14":[4,16],"41-13":[4,16],"41-12":[4,16],"41-11":[4,16],"41-10":[4,16],"40-10":[4,16],"38-10":[4,16],"37-11":[4,16],"36-12":[4,16],"35-12":[4,16],"35-13":[4,16],"33-14":[4,16],"32-15":[4,16],"32-16":[4,16],"33-16":[4,16],"34-16":[4,16],"34-15":[4,16],"35-15":[4,16],"36-14":[4,16],"37-13":[4,16],"36-13":[4,16],"34-14":[4,16],"33-15":[4,16],"31-17":[4,16],"30-18":[4,16],"32-19":[4,16],"33-19":[4,16],"34-19":[4,16],"34-18":[4,16],"35-18":[4,16],"35-17":[4,16],"35-16":[4,16],"32-17":[4,16],"41-29":[4,16],"42-29":[4,16],"44-30":[4,16],"46-31":[4,16],"48-32":[4,16],"50-33":[4,16],"53-35":[4,16],"56-36":[4,16],"58-37":[4,16],"60-37":[4,16],"62-38":[4,16],"65-40":[4,16],"66-40":[4,16],"66-41":[4,16],"68-42":[4,16],"69-42":[4,16],"69-43":[4,16],"68-43":[4,16],"67-44":[4,16],"66-44":[4,16],"65-44":[4,16],"65-45":[4,16],"64-45":[4,16],"64-46":[4,16],"63-45":[4,16],"63-44":[4,16],"63-43":[4,16],"64-42":[4,16],"64-41":[4,16],"65-39":[4,16],"66-38":[4,16],"67-37":[4,16],"68-37":[4,16],"69-37":[4,16],"70-37":[4,16],"70-38":[4,16],"71-39":[4,16],"71-40":[4,16],"71-41":[4,16],"71-43":[4,16],"71-44":[4,16],"71-46":[4,16],"70-48":[4,16],"70-50":[4,16],"70-51":[4,16],"70-52":[4,16],"69-53":[4,16],"69-54":[4,16],"70-53":[4,16],"11-4":[4,16],"12-4":[4,16],"13-4":[4,16],"14-4":[4,16],"14-5":[4,16],"14-6":[4,16],"14-7":[4,16],"13-7":[4,16],"12-7":[4,16],"11-7":[4,16],"11-6":[4,16],"12-5":[4,16],"12-6":[4,16],"11-5":[4,16],"13-5":[4,16],"13-6":[4,16],"12-1":[4,16],"12-2":[4,16],"11-2":[4,16],"11-3":[4,16],"10-3":[4,16],"12-3":[4,16],"13-3":[4,16],"13-2":[4,16],"13-1":[4,16],"14-3":[4,16],"14-2":[4,16],"86-18":[4,16],"85-18":[4,16],"84-18":[4,16],"83-18":[4,16],"83-19":[4,16],"83-20":[4,16],"83-21":[4,16],"83-22":[4,16],"83-23":[4,16],"83-24":[4,16],"83-25":[4,16],"83-26":[4,16],"83-27":[4,16],"83-28":[4,16],"82-28":[4,16],"82-29":[4,16],"82-30":[4,16],"83-30":[4,16],"84-30":[4,16],"85-30":[4,16],"86-30":[4,16],"86-29":[4,16],"87-29":[4,16],"88-29":[4,16],"88-28":[4,16],"87-28":[4,16],"87-27":[4,16],"87-26":[4,16],"86-26":[4,16],"86-27":[4,16],"85-27":[4,16],"85-26":[4,16],"85-25":[4,16],"85-24":[4,16],"85-23":[4,16],"86-23":[4,16],"87-23":[4,16],"87-22":[4,16],"88-22":[4,16],"89-22":[4,16],"89-21":[4,16],"89-20":[4,16],"88-20":[4,16],"87-20":[4,16],"87-19":[4,16],"86-19":[4,16],"85-19":[4,16],"85-21":[4,16],"82-16":[4,16],"78-19":[4,16],"78-21":[4,16],"78-27":[4,16],"78-31":[4,16],"87-34":[4,16],"92-32":[4,16],"94-25":[4,16],"94-19":[4,16],"91-17":[4,16],"78-16":[4,16],"81-33":[4,16],"89-34":[4,16],"93-28":[4,16],"93-22":[4,16],"87-16":[4,16],"78-23":[4,16],"84-33":[4,16],"84-16":[4,16],"89-16":[4,16],"92-19":[4,16],"93-21":[4,16],"53-54":[4,16],"52-54":[4,16],"52-55":[4,16],"51-55":[4,16],"50-56":[4,16],"49-57":[4,16],"48-58":[4,16],"48-59":[4,16],"47-60":[4,16],"46-61":[4,16],"46-62":[4,16],"45-62":[4,16],"45-63":[4,16],"44-64":[4,16],"44-65":[4,16],"44-66":[4,16],"44-67":[4,16],"45-67":[4,16],"46-67":[4,16],"47-67":[4,16],"48-67":[4,16],"49-67":[4,16],"50-67":[4,16],"51-67":[4,16],"51-68":[4,16],"52-68":[4,16],"53-68":[4,16],"54-68":[4,16],"54-69":[4,16],"55-69":[4,16],"55-70":[4,16],"56-70":[4,16],"56-71":[4,16],"57-71":[4,16],"57-72":[4,16],"58-73":[4,16],"59-73":[4,16],"59-74":[4,16],"60-74":[4,16],"61-74":[4,16],"62-74":[4,16],"63-74":[4,16],"64-74":[4,16],"65-74":[4,16],"66-74":[4,16],"65-73":[4,16],"64-73":[4,16],"64-72":[4,16],"63-72":[4,16],"63-71":[4,16],"62-71":[4,16],"61-70":[4,16],"60-70":[4,16],"60-69":[4,16],"59-69":[4,16],"59-68":[4,16],"59-67":[4,16],"59-66":[4,16],"58-65":[4,16],"58-64":[4,16],"58-63":[4,16],"58-62":[4,16],"58-61":[4,16],"57-61":[4,16],"56-61":[4,16],"55-61":[4,16],"54-61":[4,16],"54-60":[4,16],"53-60":[4,16],"53-59":[4,16],"53-58":[4,16],"54-58":[4,16],"54-57":[4,16],"55-57":[4,16],"55-56":[4,16],"56-56":[4,16],"56-55":[4,16],"57-55":[4,16],"57-54":[4,16],"57-53":[4,16],"58-53":[4,16],"58-52":[4,16],"57-52":[4,16],"57-51":[4,16],"56-51":[4,16],"55-51":[4,16],"54-51":[4,16],"53-51":[4,16],"52-51":[4,16],"51-51":[4,16],"51-52":[4,16],"50-52":[4,16],"50-53":[4,16],"50-54":[4,16],"49-54":[4,16],"49-55":[4,16],"48-55":[4,16],"48-56":[4,16],"48-57":[4,16],"47-57":[4,16],"47-58":[4,16],"46-58":[4,16],"46-59":[4,16],"45-59":[4,16],"44-60":[4,16],"43-60":[4,16],"42-60":[4,16],"42-61":[4,16],"41-61":[4,16],"40-61":[4,16],"40-62":[4,16],"40-63":[4,16],"41-63":[4,16],"42-63":[4,16],"42-64":[4,16],"43-64":[4,16],"43-63":[4,16],"44-63":[4,16],"44-62":[4,16],"45-61":[4,16],"45-60":[4,16],"46-60":[4,16],"47-59":[4,16],"49-58":[4,16],"50-57":[4,16],"51-56":[4,16],"51-54":[4,16],"49-53":[4,16],"49-56":[4,16],"50-55":[4,16],"44-61":[4,16],"43-61":[4,16],"41-62":[4,16],"43-62":[4,16],"42-62":[4,16],"50-65":[4,16],"50-66":[4,16],"49-66":[4,16],"49-68":[4,16],"48-68":[4,16],"48-69":[4,16],"47-69":[4,16],"46-69":[4,16],"46-70":[4,16],"45-70":[4,16],"44-70":[4,16],"43-71":[4,16],"42-71":[4,16],"42-72":[4,16],"43-72":[4,16],"44-72":[4,16],"45-72":[4,16],"46-72":[4,16],"46-71":[4,16],"45-71":[4,16],"44-71":[4,16],"47-70":[4,16],"47-68":[4,16],"51-66":[4,16],"51-65":[4,16],"51-64":[4,16],"50-68":[4,16],"50-69":[4,16],"50-70":[4,16],"50-71":[4,16],"50-72":[4,16],"50-73":[4,16],"50-74":[4,16],"50-75":[4,16],"50-76":[4,16],"49-74":[4,16],"48-74":[4,16],"47-74":[4,16],"46-74":[4,16],"45-74":[4,16],"45-75":[4,16],"45-76":[4,16],"46-76":[4,16],"47-76":[4,16],"48-76":[4,16],"48-75":[4,16],"49-75":[4,16],"47-75":[4,16],"46-75":[4,16],"49-76":[4,16],"54-53":[4,16],"47-28":[4,16],"48-28":[4,16],"49-28":[4,16],"50-27":[4,16],"51-27":[4,16],"52-27":[4,16],"51-26":[4,16],"50-26":[4,16],"50-25":[4,16],"49-25":[4,16],"49-24":[4,16],"48-23":[4,16],"48-24":[4,16],"47-24":[4,16],"47-25":[4,16],"46-25":[4,16],"46-26":[4,16],"45-26":[4,16],"45-25":[4,16],"45-24":[4,16],"45-23":[4,16],"45-21":[4,16],"44-21":[4,16],"44-23":[4,16],"44-24":[4,16],"44-25":[4,16],"47-22":[4,16],"49-22":[4,16],"50-22":[4,16],"53-22":[4,16],"54-22":[4,16],"55-22":[4,16],"55-23":[4,16],"57-23":[4,16],"61-23":[4,16],"65-23":[4,16],"64-25":[4,16],"62-26":[4,16],"61-25":[4,16],"61-24":[4,16],"59-24":[4,16],"59-25":[4,16],"58-25":[4,16],"57-25":[4,16],"56-25":[4,16],"55-25":[4,16],"55-26":[4,16],"56-26":[4,16],"56-27":[4,16],"57-27":[4,16],"58-26":[4,16],"56-28":[4,16],"56-29":[4,16],"55-30":[4,16],"55-31":[4,16],"54-32":[4,16],"53-33":[4,16],"53-34":[4,16],"53-36":[4,16],"53-37":[4,16],"53-38":[4,16],"53-39":[4,16],"54-40":[4,16],"56-41":[4,16],"57-41":[4,16],"58-41":[4,16],"59-41":[4,16],"60-41":[4,16],"61-41":[4,16],"62-41":[4,16],"63-41":[4,16],"64-40":[4,16],"66-39":[4,16],"67-39":[4,16],"67-38":[4,16],"68-38":[4,16],"68-36":[4,16],"68-34":[4,16],"69-32":[4,16],"69-31":[4,16],"69-30":[4,16],"69-29":[4,16],"69-28":[4,16],"69-27":[4,16],"68-27":[4,16],"68-26":[4,16],"67-26":[4,16],"66-26":[4,16],"61-26":[4,16],"60-26":[4,16],"60-27":[4,16],"59-27":[4,16],"58-29":[4,16],"94-54":[4,16],"93-54":[4,16],"92-54":[4,16],"91-54":[4,16],"90-54":[4,16],"89-54":[4,16],"88-54":[4,16],"87-53":[4,16],"87-54":[4,16],"87-55":[4,16],"87-56":[4,16],"87-57":[4,16],"87-58":[4,16],"87-59":[4,16],"87-60":[4,16],"87-61":[4,16],"87-62":[4,16],"87-63":[4,16],"87-64":[4,16],"87-65":[4,16],"87-66":[4,16],"88-67":[4,16],"89-67":[4,16],"90-67":[4,16],"91-67":[4,16],"92-67":[4,16],"93-67":[4,16],"94-67":[4,16],"94-66":[4,16],"95-66":[4,16],"96-66":[4,16],"96-65":[4,16],"96-64":[4,16],"96-62":[4,16],"96-61":[4,16],"96-59":[4,16],"96-57":[4,16],"97-55":[4,16],"97-54":[4,16],"97-53":[4,16],"97-52":[4,16],"97-51":[4,16],"96-52":[4,16],"95-52":[4,16],"94-52":[4,16],"93-53":[4,16],"92-53":[4,16],"91-53":[4,16],"90-53":[4,16],"89-53":[4,16],"88-53":[4,16],"94-53":[4,16],"96-53":[4,16],"96-54":[4,16],"96-55":[4,16],"96-56":[4,16],"96-58":[4,16],"96-60":[4,16],"96-63":[4,16],"96-67":[4,16],"95-67":[4,16],"93-66":[4,16],"92-66":[4,16],"91-66":[4,16],"90-66":[4,16],"89-66":[4,16],"88-66":[4,16],"88-65":[4,16],"95-54":[4,16],"95-55":[4,16],"95-56":[4,16],"95-57":[4,16],"92-62":[4,16],"93-62":[4,16],"92-61":[4,16],"91-61":[4,16],"91-60":[4,16],"90-60":[4,16],"90-59":[4,16],"89-59":[4,16],"90-58":[4,16],"91-58":[4,16],"92-58":[4,16],"92-57":[4,16],"91-59":[4,16],"91-62":[4,16],"90-62":[4,16],"93-61":[4,16],"93-60":[4,16],"92-60":[4,16],"92-59":[4,16],"93-59":[4,16],"93-58":[4,16],"93-57":[4,16],"93-56":[4,16],"92-56":[4,16],"91-56":[4,16],"90-56":[4,16],"89-56":[4,16],"90-57":[4,16],"91-57":[4,16],"92-63":[4,16],"93-63":[4,16],"94-63":[4,16],"94-62":[4,16],"94-61":[4,16],"94-60":[4,16],"50-45":[4,16],"2-25":[4,16],"2-26":[4,16],"2-27":[4,16],"2-28":[4,16],"2-29":[4,16],"2-30":[4,16],"3-30":[4,16],"3-31":[4,16],"3-32":[4,16],"126-38":[15,14],"125-38":[15,14],"125-39":[15,14],"126-39":[15,14],"126-40":[15,14],"126-41":[15,14],"126-42":[15,14],"126-43":[15,14],"126-44":[15,14],"127-44":[15,14],"127-45":[15,14],"127-46":[15,14],"126-46":[15,14],"128-45":[15,14],"128-44":[15,14],"128-43":[15,14],"128-42":[15,14],"128-41":[15,14],"127-41":[15,14],"127-40":[15,14],"127-39":[15,14],"126-45":[15,14],"125-46":[15,14],"125-45":[15,14],"125-44":[15,14],"125-43":[15,14],"125-42":[15,14],"125-41":[15,14],"125-40":[15,14],"127-43":[15,14],"127-42":[15,14],"128-46":[15,14],"128-40":[15,14],"128-39":[15,14],"127-38":[15,14],"128-38":[15,14],"30-56":[17,33],"30-55":[17,33],"129-38":[17,33],"130-38":[17,33],"131-38":[17,33],"132-38":[17,33],"132-39":[17,33],"132-40":[17,33],"132-41":[17,33],"132-42":[17,33],"132-43":[17,33],"132-44":[17,33],"132-45":[17,33],"132-46":[17,33],"131-46":[17,33],"130-46":[17,33],"129-46":[17,33],"129-45":[17,33],"129-44":[17,33],"129-43":[17,33],"129-42":[17,33],"129-41":[17,33],"129-40":[17,33],"129-39":[17,33],"130-39":[17,33],"131-39":[17,33],"130-40":[17,33],"130-41":[17,33],"131-40":[17,33],"130-42":[17,33],"131-41":[17,33],"130-43":[17,33],"131-42":[17,33],"130-44":[17,33],"131-43":[17,33],"130-45":[17,33],"131-44":[17,33],"131-45":[17,33],"133-38":[5,41],"134-38":[5,41],"135-38":[5,41],"136-38":[5,41],"137-38":[5,41],"137-39":[5,41],"137-40":[5,41],"137-41":[5,41],"137-42":[5,41],"137-43":[5,41],"137-44":[5,41],"137-45":[5,41],"137-46":[5,41],"136-46":[5,41],"135-46":[5,41],"134-46":[5,41],"133-46":[5,41],"133-45":[5,41],"133-44":[5,41],"133-43":[5,41],"133-42":[5,41],"133-41":[5,41],"133-40":[5,41],"133-39":[5,41],"134-39":[5,41],"135-39":[5,41],"136-39":[5,41],"136-40":[5,41],"136-41":[5,41],"136-42":[5,41],"136-43":[5,41],"136-44":[5,41],"136-45":[5,41],"135-45":[5,41],"134-45":[5,41],"134-44":[5,41],"134-43":[5,41],"134-42":[5,41],"134-41":[5,41],"134-40":[5,41],"135-40":[5,41],"135-41":[5,41],"135-42":[5,41],"135-43":[5,41],"135-44":[5,41]}]

//Initialize app when tileset source is done loading
tilesetImage.onload = function () {
    layers = defaultState;
    draw();
    setLayer(0);
}
tilesetImage.src = "https://assets.codepen.io/21542/TileEditorSpritesheet.2x_2.png";


(function () {
    // resize the canvas to fill browser window dynamically
    window.addEventListener('resize', resizeCanvas, false);

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        /**
         * Your drawings need to be inside this function otherwise they will be reset when 
         * you resize the browser window and the canvas goes will be cleared.
         */
        draw();
    }

    resizeCanvas();
})();
